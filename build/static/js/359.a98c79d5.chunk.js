"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[359],{359:(e,t,a)=>{a.r(t),a.d(t,{default:()=>n});const n='---\nlayout: post\ntitle:      "Sessions and Cookies and JavaScript, Oh My! - A Tutorial Series"\ndate:       2021-02-15 15:18:37 -0500\npermalink:  sessions_and_cookies_and_javascript_oh_my_-_a_tutorial_series_7\n---\n\n## Part 7: Let\u2019s Serialize!\n\nWe\u2019re back! Let\u2019s jump right into it. We currently have an application where a user can sign up, log in, view their homepage, and log out. As far as functionality is concerned, we have it all. Today we\u2019re going to make our application a bit more secure.\n\nDo me a favor, and go log into your application. Now go to your Redux DevTools and check out the state. You should see your currentUser and all of its attributes, including the password_digest. This is not great. Actually, this is really really terrible. Like really bad. We are currently exposing our user\'s password to the frontend. I don\'t even want to think about what could happen if this information were to end up in the wrong hands.\n\n<iframe src="https://giphy.com/embed/YU0j0j92jLdU4" width="480" height="270" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/YU0j0j92jLdU4">via GIPHY</a></p>\n\nThis is happening because when we grab our user instance from the backend we are grabbing all attributes with it. There must be a way to control what information we take from our database and display on the frontend. Guess what! There is!\n\n\n### Serialization\n\nWe\u2019re going to use a process called serialization. You may be thinking, "What is serialization?". That\'s a great question! <a href="https://en.wikipedia.org/wiki/Serialization">Serialization</a> is the process of taking a data structure or object and translating it into a format that can be stored so that it can be reconstructed later. You\'re probably thinking, "How the heck will I be able to do that?!" Luckily, to help us with this process, we can use a serializer. As always, there are several options out there. We\u2019re going to work with a gem called <a href="https://github.com/jsonapi-serializer/jsonapi-serializer">jsonapi-serializer</a>.\n\n<iframe src="https://giphy.com/embed/3o85xKRIokv92FRo52" width="480" height="270" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/darkigloo-breakfast-cereal-puppet-3o85xKRIokv92FRo52">via GIPHY</a></p>\n\nTo start, we want to install the gem. Add `gem \'jsonapi-serializer\'` to your Gemfile and run `bundle install`. \n\nWith our serializer installed, we can now generate a serializer. Don\u2019t be nervous, a serializer is just a class, which you are totally familiar with. And through the beauty of Rails we can generate our serializer just like we would generate anything else (models, controllers, resources, etc.). The command will look like this: `rails g serializer ModelName attributes`. In our case, we want to create a serializer for our User model, and the only attribute we want to include is username. Remember, password is an attribute of User, but that\'s the information we don\u2019t want our frontend to have access to, so we won\u2019t include it in our serializer. Our command will look like this: `rails g serializer User username`. If you run that and head over to your code editor you\u2019ll see that within your app folder you now have a serializers folder, and within this folder you have a file called user_serializer.rb. user_serializer.rb should look like this:\n\n```\nclass UserSerializer\n  include JSONAPI::Serializer\n  attributes :username\nend\n```\n\nThere is quite a bit you can do within your serializer to control the information that is translated and how that information is displayed, but for now we are working with a pretty simple model and just one attribute, so we can save that for another day (or maybe just later on in this post\u2026).\n\nYou\u2019re probably asking yourself, "How can we use this serializer to control the information that is passed to the frontend?" Again, another great question! First, let\u2019s think about what part of the backend has control over the information that gets passed to the frontend. You got it, that would be the controller! So we are going to want to change something in our controller. Let\u2019s start with our Sessions Controller. In our create method we are creating a user instance and rendering that user as JSON:\n\n```\n\u2026\n  def create\n    user = User.find_by(:username => params[:session][:username])\n\n    if user && user.authenticate(params[:session][:password])\n      session[:user_id] = user.id\n      render json: user\n    else\n      render json: {\n        error: "Invalid Credentials"\n      }\n    end\n  end\n\u2026\n```\n\nThe line we specifically want to be looking at is `render json: user`. We don\u2019t just want to render the user as JSON. We want to create a new instance of UserSerializer and pass the user instance we\'ve created as the parameter. This will ensure that the only information the frontend receives regarding the user is what we have included in our UserSerializer. Change that line to: `render json: UserSerializer.new(user), status: 200`. Before you go to your browser to see if anything has changed, you\u2019ll want to restart your Rails server. Any time you add a serializer you need to restart your server in order for it to recognize this new serializer. Okay, once you\u2019ve done that, head over to your browser. If you\u2019re logged in to your application, log out and then log in again. This time, in the Redux DevTools state you should see something a bit different. I now see my currentUser instance with an attribute of data. Data has three attributes: id, type, and attributes, and attributes has one attribute of username. I don\u2019t see any password or password_digest! That\u2019s wonderful! We\u2019ve successfully controlled the information that is getting passed to the frontend. \n\nYou can check out all of the methods you have in your Sessions Controller and Users Controller. Anytime you are rendering an instance of `user` or `current_user`, you can pass this as a parameter to UserSerializer.new to control the information being sent to the frontend. Go ahead and do that now.\n\nOne last thing we\u2019ll want to do here is update our frontend to make this new JSON object a bit easier to work with. Previously, our currentUser object had all attributes available at the top level (id, username, and password). Now if we want to grab the username we have to go to `currentUser.data.attributes.username`. We can make this a little easier for ourselves with a couple minor changes to the frontend.\n\nIn actions/currentUser.js we just need to find anywhere where we are dispatching `setCurrentUser`, and instead of passing in `json` we\u2019ll pass in `json.data`. This will automatically get us one level deeper into that user object so there will be less work to do when we need to access the user\u2019s information. Now that we\'ve updated that head back to your browser. In the state you can see that currentUser no longer has an attribute of data, and instead has attributes of id, type, and attributes. Great! Except for one thing. Take a look at the welcome header on the page. The currentUser\u2019s username is no longer displayed. What happened? If you go to your Home component, you\u2019ll notice your header displays `props.currentUser.username`. If you check out the state in the Redux DevTools, you\u2019ll see that username is an attribute of attributes, so you need to change `props.currentUser.username` to `props.currentUser.attributes.username`. And viola! Our username is displayed again.\n\n\n### What else can we do?\n\nYou may be wondering, "What else can I do with serializers?" You are full of great questions today! There is so much you can do to control the data that is being sent to the frontend. We\u2019ll go over a quick example, just to give you an idea. Let\u2019s say your user had attributes for first name and last name, but on the frontend, you just wanted to display this as full name. With a serializer you can do that! I\u2019m not going to go through a detailed code along, but I will walk you through the steps if you want to give it a shot.\n\nFor this example, we\'re just going to work on the backend. First, you would need to add columns to your Users table for `first_name` and `last_name` and run `rails db:migrate`. If you drop into your Rails console you can add a `first_name` and `last_name` to the user instance you\u2019ve been working with. In the Redux DevTools, you\u2019ll notice that you don\u2019t see any changes in your state. That\u2019s because even though we\'ve added this information to the user instance, we haven\'t changed anything in UserSerializer, so UserSerializer is still only sending username. If you add `:first_name` and `:last_name` to the list of attributes in UserSerializer you will see those populated in the state in the browser. Now let\u2019s try to display the full name. We\u2019re going to create a custom attribute called `full_name`, and this attribute is going to be a block that combines the `first_name` and `last_name` of our user object. Overall, my UserSerializer currently looks like this:\n\n```\nclass UserSerializer\n  include JSONAPI::Serializer\n  attributes :username, :first_name, :last_name\n\n  # create a custom attribute called :full_name\n  attribute :full_name do |object|\n    "#{object.first_name} #{object.last_name}"\n  end\nend\n```\n\nNow, if I head over to my browser and refresh the page, my state includes an additional attribute of `full_name` that is the combined `first_name` and `last_name` of my currentUser. How cool! This is just a minor glimpse into what you can do with serializers, but hopefully shows you how useful they can be. The real important takeaway here is that you are no longer passing sensitive information to the frontend, which is extremely important. \n\n<iframe src="https://giphy.com/embed/Od0QRnzwRBYmDU3eEO" width="480" height="480" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/primevideo-2020-borat-subsequent-moviefilm-Od0QRnzwRBYmDU3eEO">via GIPHY</a></p>\n\nWe are in the home stretch. After a bit of refactoring next week, our functionality will be complete!\n\n<br>\n\n\n#### Sources\n\n<a href="https://en.wikipedia.org/wiki/Serialization">Serialization</a>\n<br>\n<a href="https://github.com/jsonapi-serializer/jsonapi-serializer">jsonapi-serializer</a>\n<br>\n<a href="https://instruction.learn.co/student/video_lectures#/463">Flatiron School React App Build</a>\f\n'}}]);
//# sourceMappingURL=359.a98c79d5.chunk.js.map