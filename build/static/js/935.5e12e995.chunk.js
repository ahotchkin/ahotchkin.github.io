"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[935],{935:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});const o='---\nlayout: post\ntitle:      "Sessions and Cookies and JavaScript, Oh My! - A Tutorial Series"\ndate:       2021-01-25 20:04:57 -0500\npermalink:  sessions_and_cookies_and_javascript_oh_my_-_a_tutorial_series_4\n---\n\n## Part 4: Improving the User Experience\n\n\nWe have come a long way together! At this point, we have a backend API that keeps track of our users in a database, we have a frontend that maintains state in a centralized location that can be accessed from anywhere in our application, and, through the power of sessions and cookies, a user can log in to our application. There are just a few more things we\u2019ll add to complete this functionality. Today we\u2019re going to work on sending a user to their homepage once they log in, and keeping them logged in when we refresh the page.\n\n\n### The User\'s Homepage\n\n<iframe src="https://giphy.com/embed/Ii4dvuRs9WSCszbCcF" width="480" height="233" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/home-safe-exhausted-Ii4dvuRs9WSCszbCcF">via GIPHY</a></p>\n\nRight now when a user logs in to our application, the state changes and we can see currentUser populated in the Redux store, which is great! However, as far as the user is concerned, all that happens is the login form clears and all they see is a blank login form. That\'s a pretty confusing user experience. Instead, let\'s take the user to their homepage once they log in. In order to direct the user to their homepage after logging in, we\u2019ll need to create this component. As always, it can be called anything you would like, but it\u2019s best to choose something a bit descriptive. In this case, I\u2019m going to call it Home.js.\n\nFor our purposes, we don\u2019t need to have anything special here, just some indication that this is the user\u2019s homepage. We\u2019ll want to start by importing react, then we can define our component. For now, let\u2019s just return a basic message. We\u2019ll personalize this in a little bit. Lastly, we export our component. Okay, this is what I have. Maybe your\u2019s looks similar:\n\n```\nimport React from \'react\';\n\nconst Home = () => {\n\n  return (\n    <div>\n      <h1>Welcome to your Homepage!</h1>\n    </div>\n  )\n\n}\n\nexport default Home;\n```\n\nI\'m sure you remember from the past two tutorials that once you export a component the next step is to import it in its parent component. In this case, App.js is where it\'s at. If you\u2019ve been following along, App.js should look like this:\n\n```\nimport React from \u2018react\';\n\nimport Login from \'./components/Login\';\n\nfunction App() {\n  return (\n    <div>\n      <Login />\n    </div>\n  );\n}\n\nexport default App;\n```\n\nOkay, let\'s import: `import Home from \u2018./components/Home\u2019;`. Now, what we want to do here is render our Login component if no one is logged in. BUT if someone *is* logged in we want to render our new Home component. If you\u2019re thinking we\u2019re going to need to access our state, you\u2019d be correct! We need to know if currentUser has a value, or if it\'s null. If it\'s null, render Login, if it\u2019s not null, render Home. So how can we get access to currentUser? Well, it\u2019s part of our state which is stored in our Redux store, and to access our Redux store from any component in our application, we just need to use `connect`. Go ahead and import that now! Once we import `connect` we can use `mapStateToProps` to get access to that state. Don\u2019t forget, in order to have access to the state provided in `mapStateToProps`, we need to update our export to export `connect`.\n\nMy new App.js looks like this:\n\n```\nimport React from \u2018react\';\n# import connect to connect to the Redux store\nimport { connect } from \'react-redux\';\n\nimport Login from \'./components/Login\';\nimport Home from \'./components/Home\';\n\nfunction App() {\n  return (\n    <div>\n      <Login />\n    </div>\n  );\n}\n\n# add currentUser to mapStateToProps so it can be accessed as a prop in App\nconst mapStateToProps = state => {\n  return {\n    currentUser: state.currentUser,\n  }\n}\n\n# export connect to pass the state returned from mapStateToProps as a prop to App\nexport default connect(mapStateToProps)(App);\n```\n\nOkay, let\u2019s make sure this is working correctly. Why don\u2019t we try to `console.log(props.currentUser)` and see what happens. \n\nUh oh! We\u2019re trying to access props within our App component, but we didn\u2019t pass our props as a parameter. Let\u2019s fix that and try again.\n\nIf you see `null` in your console, congratulations! Log in and see if that updates. Do you see your currentUser in your console? That\u2019s great! Now we can use that to determine which component will render. In App.js where we are currently rendering Login, we want to update this to be a conditional. Again, the idea here is that if there is a current user, render Home, and if there is not a current user, render Login. It should look something like this: `{ !!props.currentUser ? <Home /> : <Login /> }`\n\nRefresh your browser and try logging in now. Do you see your welcome message! Alright! The last thing we want to do here is give the user a personalized welcome message. How could we access the current user\'s information in the Home component? I bet we can pass currentUser as a prop from App.js! Try this: `{ !!props.currentUser ? <Home currentUser={props.currentUser} /> : <Login /> }`\n\nNow, if we take a trip over to Home.js, we can pass props as a parameter and access the currentUser prop within the component. Mine looks like this:\n\n```\nimport React from \'react\';\n\nconst Home = props => {\n\n  return (\n    <div>\n      <h1>Welcome to your Home Page, {props.currentUser.username}!</h1>\n    </div>\n  )\n\n}\n\nexport default Home;\n```\n\nOkay, for one last time refresh your browser and log in. Do you see your personalized message? That\u2019s wonderful!\n\nWe just accomplished our first task! Onto #2.\n\n\n### Keep User Logged In\n\n<iframe src="https://giphy.com/embed/745LvA3hlistG" width="480" height="270" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/abcnetwork-golf-745LvA3hlistG">via GIPHY</a></p>\n\nUp to this point, whenever you refresh the page currentUser is reset to null. While we still have access to the user\'s session on the backend, we don\'t have any logic to find that session on the backend and render the user\'s information when the page refreshes. I don\u2019t know about you, but if that happened to me whenever I was logged in on a site, that would be pretty frustrating. Let\u2019s change that so a user is logged in until they either log out or close their browser window.\n\nThis is going to take some frontend and backend work. We haven\u2019t been to the backend in a while, so let\u2019s go there and see what\u2019s going on. We know that we\'re going to be fetching the current user from the backend, which means we\'ll need a route to fetch that information from. To routes.rb we go! I think it makes sense to call this something like "/get_current_user" and point to a method in our Sessions Controller. We want to work in our Sessions Controller because we\u2019re grabbing the session and retrieving the current user\u2019s information, if they are logged in. I\u2019ve added this to routes.rb: `get "/get_current_user", to: "sessions#get_current_user"`.\n\nBefore we go to our Sessions Controller to write the `get_current_user` method that our route points to, let\u2019s first go to our Application Controller and write a couple of helper methods. We\'ll write them in the Application Controller in case we need to access them in our other controllers later on. We\u2019re going to write one helper method that finds the current user (`current_user`), and another that uses this information to determine if the current user is logged in(`logged_in?`). With `current_user` we want to tell our API that if a session exists with a property of `:user_id`, then go to the users database and find the user with the id that matches `session[:user_id]` (if you\u2019ll remember all the way back to the first part of this tutorial, we set `session[:user_id]` equal to `user.id`). \n\n```\n...\n  def current_user\n    current_user ||= User.find_by_id(session[:user_id]) if session[:user_id]\n  end\n...\n```\n\n`logged_in?` is very simple \u2014 we want to check if a user is logged in. To do so, we just need to see if `current_user` returns true:\n\n```\n...\n  def logged_in?\n    !!current_user\n  end\n...\n```\n\n\nGreat! Now we can use these methods in our other controllers and it will make writing some of our upcoming methods a bit easier. To the Sessions Controller we go! This is where we want to write `get_current_user` that our `"/get_current_user"` route points to. Essentially, if a user is logged in we want to return that user object, and if not, we don\u2019t want to return anything. It should look something like this:\n\n```\n...\n  def get_current_user\n\t  # use the logged_in? helper method\n    if logged_in?\n      # use the current_user helper method\n      render json: current_user\n    else\n      render json: {\n        error: "No user is logged in\u201d\n      }\n    end\n  end\n...\n```\n\nNow that this route is set up, we can jet back over to our frontend to actions/currentUser.js. It\u2019s time to write our action to get our current user. We already have our synchronous action `setCurrentUser` that works with the reducer to set currentUser in our state. Currently our `login` action dispatches `setCurrentUser` after the user object is fetched from the API. We\u2019re going to write another asynchronous action that also dispatches `setCurrentUser`. We\u2019ll call it `getCurrentUser`. This will be very similar to `login` with a few subtle changes. \n\nThe first change is that we won\u2019t be passing any credentials to `getCurrentUser`. There isn\'t any user input when it comes to refreshing a page, so there isn\'t any information to pass to this function. Next, our fetch request needs a facelift. For one, it will be going to a different route \u2014 the one we just created on the backend! Also, this is going to be a "GET" request instead of a "POST" request. We already have our current user stored on the backend in the session, so we just need to get this information, not post anything. Everything we have in our chained `.then()`s will stay the same, so we\'re in good shape here. We still want to use our `setCurrentUser` synchronous action to take the user object returned from our fetch request and use it to set `currentUser` in our state. Here\u2019s what it should look like when all is said and done:\n\n```\n...\n  export const getCurrentUser = () => {\n    return dispatch => {\n      return fetch("http://localhost:3001/get_current_user", {\n        credentials: "include",\n        method: "GET",\n        headers: {\n          "Content-type": "application/json"\n        },\n      })\n        .then(response => response.json())\n        .then(json => {\n          if (json.error) {\n            throw new Error(json.error)\n          } else {\n            dispatch(setCurrentUser(json))\n          }\n        })\n        .catch(json => console.log(json))\n    }\n  }\n...\n```\n\nThe last thing we need to do is call `getCurrentUser` at some point. Since we\'re working from App.js, it makes the most sense to do so whenever our App component renders.\n\nThis will require some changes to App.js. Now, I know there are new and improved ways to accomplish what we\u2019re about to do, but at this point I\u2019m not totally familiar with how React Hooks work. As such, we\u2019re going a bit old school and we\u2019re going to work with class components and lifecycle methods. By using `componentDidMount` to call `getCurrentUser`, whenever the page refreshes (and the component mounts) it will trigger our application to call `getCurrentUser` and grab the current user if there is one. First, we have to change App to a class component. It\u2019s as simple as 1, 2, 3:\n1. Import { Component } from \u2018react\u2019;\n2. Define App as a class component that extends `Component`\n3. Move your return statement to inside your `render` function (every class component in React needs a `render` function that returns JSX)\n\n\nOkay fine, it\u2019s as simple as 1, 2, 3, 4:&#x2028;\n4. Update all instances of `props` to `this.props`\n\nIf things still aren\u2019t working right, make sure if you have any `console.log`s they are being called inside your render function, before your return statement.\n\nOur App component is now a class component! On to `getCurrentUser`. First, we need access to our `getCurrentUser` function from actions/currentUser.js. To get access, we need to import it. And because it\'s an action, after importing we need to add it as an action to `mapDispatchToProps`. We then add `mapDispatchToProps` as our second argument to `connect`, and viola! We can now access `getCurrentUser` as a prop in App, which we will do in `componentDidMount`. Here is my updated App component:\n\n```\nimport React, { Component } from \'react\';\nimport { connect } from \'react-redux\';\n\nimport Login from \'./components/Login\';\nimport Home from \'./components/Home\';\nimport { getCurrentUser } from \'./actions/currentUser\';\n\nclass App extends Component {\n\n  componentDidMount() {\n    this.props.getCurrentUser()\n  }\n\n  render() {\n    return (\n      <div>\n        { !!this.props.currentUser ? <Home currentUser={this.props.currentUser} /> : <Login /> }\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    currentUser: state.currentUser,\n  }\n}\n\nconst mapDispatchToProps = {\n  getCurrentUser\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\n```\n\nNow, go back to your browser. If you\u2019re not already logged in, do so now. If you are, try refreshing the page. Are you still logged in? Fantastic! We did it! This is going to make our user experience so much better! Obviously there is still work to be done. Next week we\u2019ll work on logging out. Until then, breathe a sigh of relief and keep coding!\n\n<iframe src="https://giphy.com/embed/TI9HXsiQr4eU9hdxgC" width="480" height="480" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/cbc-schittscreek-catherine-ohara-moira-TI9HXsiQr4eU9hdxgC">via GIPHY</a></p>\n\n<br>\n\n#### Sources\n<a href="https://reactjs.org/docs/react-component.html">ComponentDidMount</a>\n<br>\n<a href="https://instruction.learn.co/student/video_lectures#/463">Flatiron School React App Build</a>\f# Enter your title here\n'}}]);
//# sourceMappingURL=935.5e12e995.chunk.js.map